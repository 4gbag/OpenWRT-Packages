webpackJsonp([0],{boUx:function(s,i){},pNZA:function(s,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=t("BO1k"),n=t.n(a),e=t("//Fk"),l=t.n(e),o={name:"AppManagerApp",data:function(){return{currentTab:"available",tabs:{available:{name:"Available"},installed:{name:"Installed"}},isLoading:!0,isInstalling:!1,isOOSUpdating:!1,installedApps:[],availableApps:[],onionOs:{id:"onion-os",available:"",installed:"",showModal:!1},appFilter:""}},methods:{mergedAppList:function(){for(var s=0;s<this.installedApps.length;s++)for(var i=this.installedApps[s],t=0;t<this.availableApps.length;t++){var a=this.availableApps[t];i.id===a.id&&(a.installed=!0,a.installedVersion=i.version,this.$set(this.availableApps,t,a))}},appShow:function(s){return"installed"!==this.currentTab||s.installed},displayAppVersion:function(s){return"installed"===this.currentTab?s.installedVersion:s.version},getApps:function(){return new l.a(function(s,i){var t=this;this.isLoading=!0,this.availableApps=[],this.$store.dispatch("httpGetRequest",{url:"http://repo.onion.io.s3.amazonaws.com/omega2/packages/onion/Packages"}).then(function(i){for(var a=i.data.match(/^Package: (\S+)/gm),n=i.data.match(/^Description: (.+)/gm),e=i.data.match(/^Version: (.+)/gm),l=0;l<a.length;l++){var o=a[l].split(": ");if(o[1]&&o[1].match(/^oos-/)){var p=n[l].split(": ");t.availableApps.push({id:o[1],version:e[l].split(": ")[1],name:p[1].slice(1,-1),description:p[2]})}else o[1]&&o[1]===t.onionOs.id&&(t.onionOs.available=e[l].split(": ")[1])}t.mergedAppList(),s()})}.bind(this))},getInstalledApps:function(){return new l.a(function(s,i){var t=this;this.$store.dispatch("handleCommand",{cmd:"opkg",params:["list-installed"]}).then(function(i){t.installedApps=[];var a=!0,e=!1,l=void 0;try{for(var o,p=n()(i.stdout.split("\n"));!(a=(o=p.next()).done);a=!0){var r=o.value;if(r.indexOf("oos-app")>-1){var d=r.split(" - ");t.installedApps.push({id:d[0],version:d[1]})}else if(r.match(/^onion-os /)){var c=r.split(" - ");t.onionOs.installed=c[1]}}}catch(s){e=!0,l=s}finally{try{!a&&p.return&&p.return()}finally{if(e)throw l}}t.mergedAppList(),s()})}.bind(this))},openApp:function(s){this.$store.dispatch("launchApp",{appId:s.id})},opkgOperation:function(s){return new l.a(function(i,t){var a=this;this.isInstalling=!0,this.$store.dispatch("handleScript",{code:s}).then(function(s){return a.$store.dispatch("waitProcess",{pid:s.pid})}).then(function(){a.isInstalling=!1,a.$store.dispatch("refreshAppList"),i()})}.bind(this))},installApp:function(s,i){var t=this;this.isInstalling=!0,s.installing=!0,this.$set(this.availableApps,i,s),this.$store.dispatch("handleScript",{code:"opkg update; opkg install "+s.id}).then(function(s){return t.$store.dispatch("waitProcess",{pid:s.pid})}).then(function(){s.installing=!1,s.installed=!0,s.installedVersion=s.version,t.isInstalling=!1,t.$set(t.availableApps,i,s),t.$store.dispatch("refreshAppList")})},removeApp:function(s,i){var t=this;this.isInstalling=!0,s.installing=!0,this.$set(this.availableApps,i,s),this.$store.dispatch("handleScript",{code:"opkg remove "+s.id}).then(function(s){return t.$store.dispatch("waitProcess",{pid:s.pid})}).then(function(){s.installing=!1,s.installed=!1,s.installedVersion=null,t.isInstalling=!1,t.$set(t.availableApps,i,s),t.$store.dispatch("refreshAppList")})},updateApp:function(s,i){var t=this;s.installedVersion=s.version,s.installing=!0,this.$set(this.availableApps,i,s),this.opkgOperation("opkg update; opkg upgrade "+s.id).then(function(){s.installing=!1,s.installed=!0,t.$set(t.availableApps,i,s)})},updateOnionOs:function(){var s=this;this.isOOSUpdating=!0,this.opkgOperation("opkg update; opkg upgrade "+this.onionOs.id).then(function(){s.isOOSUpdating=!1,s.onionOs.showModal=!0,setTimeout(function(){location.reload()},3e3)})}},created:function(){var s=this,i=this.getApps(),t=this.getInstalledApps();l.a.all([i,t]).then(function(){s.isLoading=!1})}},p={render:function(){var s=this,i=s.$createElement,t=s._self._c||i;return t("div",{staticClass:"container app-view"},[t("div",{staticClass:"modal",class:{active:s.onionOs.showModal}},[t("a",{staticClass:"modal-overlay"}),s._v(" "),s._m(0)]),s._v(" "),t("ul",{staticClass:"tab tab-block"},s._l(s.tabs,function(i,a){return t("li",{key:a,staticClass:"tab-item"},[t("a",{staticClass:"c-hand",class:{active:a===s.currentTab,badge:i.badge},attrs:{"data-badge":i.badge},on:{click:function(i){s.currentTab=a}}},[s._v(s._s(i.name))])])})),s._v(" "),t("div",{staticClass:"app-body"},[t("ul",{staticClass:"menu app-menu"},[t("li",{staticClass:"menu-item"},[t("div",{staticClass:"tile tile-centered"},[t("div",{staticClass:"tile-icon",on:{click:s.getApps}},[t("img",{staticClass:"avatar",attrs:{src:"static/img/icons/store.svg"}})]),s._v(" "),t("div",{staticClass:"tile-content"},[s._v("App Manager")])])]),s._v(" "),t("li",{staticClass:"divider"}),s._v(" "),s._l(s.tabs,function(i,a){return t("li",{key:a,staticClass:"menu-item"},[t("a",{staticClass:"c-hand",class:{active:a===s.currentTab,badge:i.badge},attrs:{"data-badge":i.badge},on:{click:function(i){s.currentTab=a}}},[s._v("\n          "+s._s(i.name)+"\n        ")])])})],2),s._v(" "),t("div",{staticClass:"app-content"},[t("div",{staticClass:"card app-list"},[t("div",{staticClass:"card-header"},[t("span",{staticClass:"card-title h5"},[s._v("Onion OS Apps ")]),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.isLoading&&s.onionOs.installed!==s.onionOs.available,expression:"!isLoading && onionOs.installed !== onionOs.available"}],staticClass:"oos-upgrade-message float-right"},[s._v("\n            A new version of OnionOS is available\n            "),t("button",{staticClass:"btn btn-success float-right",class:{loading:s.isOOSUpdating,disabled:s.isInstalling},on:{click:function(i){s.updateOnionOs()}}},[s._v("Update Now")])]),s._v(" "),t("span",{staticClass:"loading-lg loading-icon float-right",class:{loading:s.isLoading}})]),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!s.isLoading,expression:"!isLoading"}],staticClass:"card-body app-list-body"},s._l(s.availableApps,function(i,a){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.appShow(i),expression:"appShow(app)"}],key:i.id,staticClass:"card app-item"},[t("div",{staticClass:"card-body"},[t("img",{staticClass:"app-icon",attrs:{src:"http://repo.onioniot.com/onionos/apps/icons/"+i.id+".svg",onerror:"this.src = 'static/img/icons/onion.svg'",alt:""}}),s._v(" "),t("div",{staticClass:"app-description"},[t("strong",[s._v(s._s(i.name))]),s._v(" "),t("br"),s._v("\n                "+s._s(i.description)),t("br"),s._v(" "),t("i",{staticClass:"app-version"},[s._v("Version "+s._s(s.displayAppVersion(i)))])])]),s._v(" "),t("div",{staticClass:"card-footer"},[i.installed?t("button",{staticClass:"btn btn-error float-right",class:{loading:i.installing,disabled:s.isInstalling},on:{click:function(t){s.removeApp(i,a)}}},[s._v("Remove")]):s._e(),s._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:i.installed&&i.version!==i.installedVersion,expression:"app.installed && (app.version !== app.installedVersion)"}],staticClass:"btn float-right",class:{loading:i.installing,disabled:s.isInstalling},on:{click:function(t){s.updateApp(i,a)}}},[s._v("Update")]),s._v(" "),i.installed?s._e():t("button",{staticClass:"btn btn-success float-right",class:{loading:i.installing,disabled:s.isInstalling},on:{click:function(t){s.installApp(i,a)}}},[s._v("Install")])])])}))])])])])},staticRenderFns:[function(){var s=this.$createElement,i=this._self._c||s;return i("div",{staticClass:"modal-container"},[i("div",{staticClass:"modal-header"},[i("div",{staticClass:"modal-title h5"},[this._v("Update Complete")])]),this._v(" "),i("div",{staticClass:"modal-body"},[i("div",{staticClass:"content label",staticStyle:{padding:"10px"}},[this._v("\n          Your browser will refresh in a few seconds\n        ")])])])}]};var r=t("VU/8")(o,p,!1,function(s){t("boUx")},"data-v-6a1e7d52",null);i.default=r.exports}});
//# sourceMappingURL=0.9024a6db9cf134010a78.js.map