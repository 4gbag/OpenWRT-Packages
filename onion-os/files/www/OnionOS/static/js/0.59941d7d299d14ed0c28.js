webpackJsonp([0],{BsAL:function(t,s){},pNZA:function(t,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=a("BO1k"),n=a.n(i),e={name:"AppManagerApp",data:function(){return{currentTab:"available",tabs:{available:{name:"Available"},installed:{name:"Installed"}},isLoading:!0,isInstalling:!1,installedApps:[],availableApps:[],appFilter:""}},methods:{mergedAppList:function(){for(var t=0;t<this.availableApps.length;t++){var s=this.availableApps[t];this.installedApps.indexOf(s.id)>-1&&(s.installed=!0,this.$set(this.availableApps,t,s))}},appShow:function(t){return"installed"!==this.currentTab||t.installed},getApps:function(){var t=this;this.isLoading=!0,this.$store.dispatch("handleScript",{code:'if [ ! -f /tmp/oos-app-list ]; then sleep 1; opkg update; opkg find "oos-app*" > /tmp/oos-app-list; fi'}).then(function(s){return t.$store.dispatch("waitProcess",{pid:s.pid})}).then(function(){return t.$store.dispatch("readFile",{path:"/tmp/oos-app-list"})}).then(function(s){t.availableApps=[];var a=!0,i=!1,e=void 0;try{for(var l,p=n()(s.data.split("\n"));!(a=(l=p.next()).done);a=!0){var r=l.value;if(!(r.length<2)){var c=r.split(" - "),o=["",""];r.length>2&&(o=c[2].split(" : ")),t.availableApps.push({id:c[0],version:c[1],name:o[0],description:o[1]})}}}catch(t){i=!0,e=t}finally{try{!a&&p.return&&p.return()}finally{if(i)throw e}}t.mergedAppList(),t.isLoading=!1})},getInstalledApps:function(){var t=this;this.$store.dispatch("handleCommand",{cmd:"opkg",params:["list-installed"]}).then(function(s){t.installedApps=[];var a=!0,i=!1,e=void 0;try{for(var l,p=n()(s.stdout.split("\n"));!(a=(l=p.next()).done);a=!0){var r=l.value;if(r.indexOf("oos-app")>-1){var c=r.split(" - ");t.installedApps.push(c[0])}}}catch(t){i=!0,e=t}finally{try{!a&&p.return&&p.return()}finally{if(i)throw e}}t.mergedAppList()})},openApp:function(t){this.$store.dispatch("launchApp",{appId:t.id})},installApp:function(t,s){var a=this;this.isInstalling=!0,t.installing=!0,this.$set(this.availableApps,s,t),this.$store.dispatch("handleScript",{code:"opkg install "+t.id}).then(function(t){return a.$store.dispatch("waitProcess",{pid:t.pid})}).then(function(){t.installing=!1,t.installed=!0,a.isInstalling=!1,a.$set(a.availableApps,s,t),a.$store.dispatch("refreshAppList")})},removeApp:function(t,s){var a=this;this.isInstalling=!0,t.installing=!0,this.$set(this.availableApps,s,t),this.$store.dispatch("handleScript",{code:"opkg remove "+t.id}).then(function(t){return a.$store.dispatch("waitProcess",{pid:t.pid})}).then(function(){t.installing=!1,t.installed=!1,a.isInstalling=!1,a.$set(a.availableApps,s,t),a.$store.dispatch("refreshAppList")})}},created:function(){this.getApps(),this.getInstalledApps()}},l={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"container app-view"},[a("ul",{staticClass:"tab tab-block"},t._l(t.tabs,function(s,i){return a("li",{key:i,staticClass:"tab-item"},[a("a",{staticClass:"c-hand",class:{active:i===t.currentTab,badge:s.badge},attrs:{"data-badge":s.badge},on:{click:function(s){t.currentTab=i}}},[t._v(t._s(s.name))])])})),t._v(" "),a("div",{staticClass:"app-body"},[a("ul",{staticClass:"menu app-menu"},[a("li",{staticClass:"menu-item"},[a("div",{staticClass:"tile tile-centered"},[a("div",{staticClass:"tile-icon",on:{click:t.getApps}},[a("img",{staticClass:"avatar",attrs:{src:"static/img/icons/store.svg"}})]),t._v(" "),a("div",{staticClass:"tile-content"},[t._v("App Manager")])])]),t._v(" "),a("li",{staticClass:"divider"}),t._v(" "),t._l(t.tabs,function(s,i){return a("li",{key:i,staticClass:"menu-item"},[a("a",{staticClass:"c-hand",class:{active:i===t.currentTab,badge:s.badge},attrs:{"data-badge":s.badge},on:{click:function(s){t.currentTab=i}}},[t._v("\n          "+t._s(s.name)+"\n        ")])])})],2),t._v(" "),a("div",{staticClass:"app-content"},[a("div",{staticClass:"card app-list"},[a("div",{staticClass:"card-header"},[a("span",{staticClass:"loading-lg loading-icon float-right",class:{loading:t.isLoading}}),t._v(" "),a("span",{staticClass:"card-title h5"},[t._v("Onion OS Apps ")])]),t._v(" "),a("div",{staticClass:"card-body app-list-body"},t._l(t.availableApps,function(s,i){return a("div",{directives:[{name:"show",rawName:"v-show",value:t.appShow(s),expression:"appShow(app)"}],key:s.id,staticClass:"card app-item"},[a("div",{staticClass:"card-body"},[a("img",{staticClass:"app-icon",attrs:{src:"http://repo.onioniot.com/onionos/apps/icons/"+s.id+".svg",onerror:"this.src = 'static/img/icons/onion.svg'",alt:""}}),t._v(" "),a("div",{staticClass:"app-description"},[a("strong",[t._v(t._s(s.name))]),t._v(" "),a("br"),t._v("\n                "+t._s(s.description)),a("br"),t._v(" "),a("i",{staticClass:"app-version"},[t._v("Version "+t._s(s.version))])])]),t._v(" "),a("div",{staticClass:"card-footer"},[s.installed?a("button",{staticClass:"btn btn-error float-right",class:{loading:s.installing,disabled:t.isInstalling},on:{click:function(a){t.removeApp(s,i)}}},[t._v("Remove")]):t._e(),t._v(" "),s.installed?t._e():a("button",{staticClass:"btn btn-success float-right",class:{loading:s.installing,disabled:t.isInstalling},on:{click:function(a){t.installApp(s,i)}}},[t._v("Install")])])])}))])])])])},staticRenderFns:[]};var p=a("VU/8")(e,l,!1,function(t){a("BsAL")},"data-v-ec63d8d8",null);s.default=p.exports}});
//# sourceMappingURL=0.59941d7d299d14ed0c28.js.map